<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fit or Re-fit Poisson Non-negative Matrix Factorization — fit_poisson_nmf • fastTopics</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fit or Re-fit Poisson Non-negative Matrix Factorization — fit_poisson_nmf" />
<meta property="og:description" content="This function approximates the input matrix X
  by the non-negative matrix factorization L %*% t(F) by
  nonnegative matrix factorization (NMF), in which the quality of the
  approximation is measured by a &amp;#8220;divergence&amp;#8221; criterion;
  equivalently, it optimizes the likelihood under a Poisson model of
  the count data, X. It runs a specified number of coordinate-wise
  updates to fit the L and F matrices." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastTopics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/stephenslab/fastTopics">Source</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fit or Re-fit Poisson Non-negative Matrix Factorization</h1>
    <small class="dont-index">Source: <a href='https://github.com/stephenslab/fastTopics/blob/master/R/fit_poisson_nmf.R'><code>R/fit_poisson_nmf.R</code></a></small>
    <div class="hidden name"><code>fit_poisson_nmf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function approximates the input matrix <code>X</code>
  by the non-negative matrix factorization <code>L %*% t(F)</code> by
  nonnegative matrix factorization (NMF), in which the quality of the
  approximation is measured by a &#8220;divergence&#8221; criterion;
  equivalently, it optimizes the likelihood under a Poisson model of
  the count data, X. It runs a specified number of coordinate-wise
  updates to fit the L and F matrices.</p>
    </div>

    <pre class="usage"><span class='fu'>fit_poisson_nmf</span>(
  <span class='no'>X</span>,
  <span class='no'>k</span>,
  <span class='no'>fit0</span>,
  <span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"em"</span>, <span class='st'>"scd"</span>, <span class='st'>"ccd"</span>, <span class='st'>"mu"</span>),
  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(),
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>
)

<span class='fu'>init_poisson_nmf</span>(
  <span class='no'>X</span>,
  <span class='no'>F</span>,
  <span class='no'>L</span>,
  <span class='no'>k</span>,
  <span class='kw'>beta</span> <span class='kw'>=</span> <span class='fl'>0.5</span>,
  <span class='kw'>betamax</span> <span class='kw'>=</span> <span class='fl'>0.99</span>,
  <span class='kw'>minval</span> <span class='kw'>=</span> <span class='fu'>fit_poisson_nmf_control_default</span>()$<span class='no'>minval</span>,
  <span class='kw'>e</span> <span class='kw'>=</span> <span class='fu'>fit_poisson_nmf_control_default</span>()$<span class='no'>eps</span>
)

<span class='fu'>fit_poisson_nmf_control_default</span>()</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>The n x m matrix of counts; all entries of X should be
non-negative. It can be a sparse matrix (class <code>"dgCMatrix"</code>)
or dense matrix (class <code>"matrix"</code>), with some exceptions (see
&#8216;Details&#8217;).</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>An integer 2 or greater giving the matrix rank for a
random initialization of the factors and loadings. (They are
initialized uniformly at random.) This argument should only be
specified if the initial fit (<code>fit0</code> or <code>F, L</code>) are not
already provided.</p></td>
    </tr>
    <tr>
      <th>fit0</th>
      <td><p>The initial model fit. It should be an object of class
&#8220;poisson_nmf_fit&#8221;, such as an output from
<code>init_poisson_nmf</code>, or from a previous call to
<code>fit_poisson_nmf</code>.</p></td>
    </tr>
    <tr>
      <th>numiter</th>
      <td><p>The number of updates of the factors and loadings to
perform.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The method to use for updating the factors and
loadings. Five methods are implemented: multiplicative updates,
<code>method = "mu"</code>; expectation maximization (EM), <code>method =
"em"</code>; sequential co-ordinate descent (SCD), <code>method = "scd"</code>;
and cyclic co-ordinate descent (CCD), <code>method = "ccd"</code>. See
&#8216;Details&#8217; for a detailed description of these methods.</p></td>
    </tr>
    <tr>
      <th>control</th>
      <td><p>A list of parameters controlling the behaviour of
the optimization algorithm. See &#8216;Details&#8217;.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>When <code>verbose = TRUE</code>, information about the
algorithm's progress is printed to the console at each
iteration. For interpretation of the columns, see the description
of the <code>progress</code> return value.</p></td>
    </tr>
    <tr>
      <th>F</th>
      <td><p>An optional argument giving is the initial estimate of the
factors (also sometimes called the "basis vectors"). It should be
an m x k matrix, where m is the number of columns in the counts
matrix <code>X</code>, and k &gt; 1 is the rank of the matrix factorization
(equivalently, the number of "topics"). All entries of <code>F</code>
should be non-negative. When not provided, input argument <code>k</code>
should be specified instead.</p></td>
    </tr>
    <tr>
      <th>L</th>
      <td><p>An optional argument giving the initial estimate of the
loadings (also sometimes called the "activations"). It should an n
x k matrix, where n is the number of rows in the counts matrix
<code>X</code>, and k &gt; 1 is the rank of the matrix factorization
(equivalently, the number of "topics"). All entries of <code>L</code>
should be non-negative. When not provided, input argument <code>k</code>
should be specified instead.</p></td>
    </tr>
    <tr>
      <th>beta</th>
      <td><p>Initial setting of the extrapolation parameter. This is
\(beta\) in Algorithm 3 of Ang &amp; Gillis (2019).</p></td>
    </tr>
    <tr>
      <th>betamax</th>
      <td><p>Initial setting for the upper bound on the
extrapolation parameter. This is \(\bar{\gamma}\) in Algorithm 3
of Ang &amp; Gillis (2019).</p></td>
    </tr>
    <tr>
      <th>minval</th>
      <td><p>A small, positive constant used to safeguard the</p></td>
    </tr>
    <tr>
      <th>e</th>
      <td><p>A small, non-negative number added to the terms inside the
logarithms to avoid computing logarithms of zero. See the
description of <code>control$eps</code> in "Details" for more
information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Both <code>init_poisson_nmf</code> and <code>fit_poisson_nmf</code>
return an object capturing the optimization algorithm state (for
<code>init_poisson_nmf</code>, this is the initial state). It is a list
with the following elements:</p>
<dt>F</dt><dd><p>A matrix containing the current best estimates of the
  factors.</p></dd>

<dt>L</dt><dd><p>A matrix containing the current best estimates of the
  loadings.</p></dd>

<dt>Fn</dt><dd><p>A matrix containing the non-extrapolated factor estimates.
  If extrapolation is not used, <code>Fn</code> and <code>F</code> will be the
  same.</p></dd>

<dt>Ln</dt><dd><p>A matrix containing the non-extrapolated estimates of the
  loadings. If extrapolation is not used, <code>Ln</code> and <code>L</code> will
  be the same.</p></dd>

<dt>Fy</dt><dd><p>A matrix containing the extrapolated factor estimates. If
  the extrapolation scheme is not used, <code>Fy</code> and <code>F</code> will
  be the same.</p></dd>

<dt>Ly</dt><dd><p>A matrix containing the extrapolated estimates of the
  loadings. If extrapolation is not used, <code>Ly</code> and <code>L</code> will
  be the same.</p></dd>

<dt>loss</dt><dd><p>Value of the objective (&#8220;loss&#8221;) function
  computed at the current best estimates of the factors and
  loadings.</p></dd>

<dt>loss.fnly</dt><dd><p>Value of the objective (&#8220;loss&#8221;) function
  computed at the extrapolated solution for the loadings (<code>Ly</code>)
  and the non-extrapolated solution for the factors (<code>Fn</code>). This
  is used internally to implement the extrapolated updates.</p></dd>

<dt>beta</dt><dd><p>The extrapolation parameter, \(beta\) in Algorithm 3
  of Ang &amp; Gillis (2019).</p></dd>

<dt>betamax</dt><dd><p>Upper bound on the extrapolation parameter. This is
  \(\bar{\gamma}\) in Algorithm 3 of Ang &amp; Gillis (2019).</p></dd>

<dt>beta0</dt><dd><p>The setting of the extrapolation parameter at the
  last iteration that improved the solution.</p></dd>

<dt>progress</dt><dd><p>A data frame containing detailed information about
  the algorithm's progress. The data frame should have <code>numiter</code>
  rows. The columns of the data frame are: "iter", the iteration
  number; "loglik", the log-likelihood at the current best factor and
  loading estimates; "dev", the deviance at the current best factor
  and loading estimates; "res", the maximum residual of the
  Karush-Kuhn-Tucker (KKT) first-order optimality conditions at the
  current best factor and loading estimates; "delta.f", the largest
  change in the factors matrix; "delta.l", the largest change in the
  loadings matrix; "nonzeros.f", the proportion of entries in the
  factors matrix that are nonzero; "nonzeros.l", the proportion of
  entries in the loadings matrix that are nonzero; "extrapolate",
  which is 1 if extrapolation is used, otherwise it is 0; "beta", the
  setting of the extrapolation parameter; "betamax", the setting of
  the extrapolation parameter upper bound; and "timing", the elapsed
  time in seconds (recorded using <code><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></code>).</p></dd>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Using this function requires some care; only minimal
argument checking is performed, and error messages may not be
helpful.</p>
<p>The EM and multiplicative updates are simple and fast, but can be
slow to converge to a stationary point. When <code>control$numiter
= 1</code>, the EM and multiplicative updates are mathematically
equivalent to the multiplicative updates, and therefore share the
same convergence properties. However, the implementation of the EM
updates is quite different; in particular, the EM updates are more
suitable for sparse counts matrices. The implementation of the
multiplicative updates is adapted from the MATLAB code by Daichi
Kitamura <a href='http://d-kitamura.net'>http://d-kitamura.net</a>.</p>
<p>Since the multiplicative updates are implemented using standard
matrix operations, the speed is heavily dependent on the
BLAS/LAPACK numerical libraries used. In particular, using
optimized implementations such as OpenBLAS or Intel MKL can result
in much improved performance of the multiplcative updates.</p>
<p>The cyclic co-ordinate descent (CCD) and sequential co-ordinate
descent (SCD) updates adopt the same optimization strategy, but
differ in the implementation details. In practice, we have found
that the CCD and SCD updates arrive at the same solution when
initialized "sufficiently close" to a stationary point. The CCD
implementation is adapted from the C++ code developed by Cho-Jui
Hsieh and Inderjit Dhillon, which is available for download at
<a href='https://www.cs.utexas.edu/~cjhsieh/nmf'>https://www.cs.utexas.edu/~cjhsieh/nmf</a>. The SCD
implementation is based on version 0.4-3 of the NNLM package.</p>
<p>An additional re-scaling step is performed after each update to
promote numerical stability.</p>
<p>The <code>control</code> argument is a list in which any of the
following named components will override the default optimization
algorithm settings (as they are defined by
<code>fit_poisson_nmf_control_default</code>):</p>
<dl class='dl-horizontal'>

<dt><code>numiter</code></dt><dd><p>Number of "inner loop" iterations to run when
  performing and update of the factors or loadings. This must be set
  to 1 for <code>method = "mu"</code> and, <code>method = "ccd"</code>.</p></dd>

<dt><code>nc</code></dt><dd><p>Number of RcppParallel threads to use for the
  updates. When <code>nc</code> is <code>NA</code>, the default number of threads
  is used; see <code><a href='https://rdrr.io/pkg/RcppParallel/man/setThreadOptions.html'>defaultNumThreads</a></code>. This
  setting is ignored for the multiplicative upates (<code>method =
  "mu"</code>).</p></dd>

<dt><code>minval</code></dt><dd><p>A small, positive constant used to safeguard
  the multiplicative updates. The safeguarded updates are implemented
  as <code>F &lt;- pmax(F1,minval)</code> and <code>L &lt;- pmax(L1,minval)</code>,
  where <code>F1</code> and <code>L1</code> are the factors and loadings matrices
  obtained by applying an update. Thi is motivated by Theorem 1 of
  Gillis &amp; Glineur (2012). Setting <code>minval = 0</code> is allowed, but
  some methods are not guaranteed to converge to a stationary point
  without this safeguard, and a warning will be given in this case.</p></dd>

<dt><code>extrapolate</code></dt><dd><p>When <code>extrapolate = TRUE</code>, the
  extrapolation scheme of Ang &amp; Gillis (2019) is used.</p></dd>

<dt><code>extrapolate.reset</code></dt><dd><p>To promote better numerical
  stability of the extrapolated updates, they are &#8220;reset&#8221;
  every so often. This parameter determines the number of iterations
  to wait before resetting.</p></dd>

<dt><code>beta.increase</code></dt><dd><p>When the extrapolated update improves
  the solution, scale the extrapolation parameter by this amount.</p></dd>

<dt><code>beta.reduce</code></dt><dd><p>When the extrapolaaed update does not
  improve the solution, scale the extrapolation parameter by this
  amount.</p></dd>

<dt><code>betamax.increase</code></dt><dd><p>When the extrapolated update
  improves the solution, scale the extrapolation parameter by this
  amount.</p></dd>

<dt><code>eps</code></dt><dd><p>A small, non-negative number that is added to the
  terms inside the logarithms to sidestep computing logarithms of
  zero. This prevents numerical problems at the cost of introducing a
  small inaccuracy in the solution. Increasing this number may lead
  to faster convergence but possibly a less accurate solution.</p></dd>

<dt><code>zero.threshold</code></dt><dd><p>A small, non-negative number used to
  determine which entries of the solution are exactly zero. Any
  entries that are less than or equal to <code>zero.threshold</code> are
  considered to be exactly zero.</p></dd>
</dl>

    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ang, A. and Gillis, N. (2019). Accelerating nonnegative matrix
  factorization algorithms using extrapolation. <em>Neural
  Computation</em> <b>31</b>, 417–439.</p>
<p>Cichocki, A., Cruces, S. and Amari, S. (2011). Generalized
  alpha-beta divergences and their application to robust nonnegative
  matrix factorization. <em>Entropy</em> <b>13</b>, 134–170.</p>
<p>Gillis, N. and Glineur, F. (2012). Accelerated multiplicative
  updates and hierarchical ALS algorithms for nonnegative matrix
  factorization. <em>Neural Computation</em> <code>24</code>, 1085–1105.</p>
<p>Hsieh, C.-J. and Dhillon, I. (2011). Fast coordinate descent
  methods with variable selection for non-negative matrix
  factorization. In <em>Proceedings of the 17th ACM SIGKDD
  international conference on Knowledge discovery and data mining</em>,
  p. 1064-1072</p>
<p>Kim, Y., Carbonetto, P., Stephens, M. and Anitescu, M. (2020) A
  fast algorithm for maximum likelihood estimation of mixture
  proportions using sequential quadratic programming. To appear in
  <em>Journal of Computational and Graphical Statistics.</em></p>
<p>Lee, D. D. and Seung, H. S. (2001). Algorithms for non-negative
  matrix factorization. In <em>Advances in Neural Information
  Processing Systems</em> <b>13</b>, 556–562.</p>
<p>Lin, X. and Boutros, P. C. (2018). Fast nonnegative matrix
  factorization and applications to pattern extraction, deconvolution
  and imputation. <em>bioRxiv</em> doi:10.1101/321802.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Simulate a 80 x 100 data set.</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>Matrix</span>)
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>1</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulate_count_data.html'>simulate_count_data</a></span>(<span class='fl'>80</span>,<span class='fl'>100</span>,<span class='fl'>3</span>)$<span class='no'>X</span>

<span class='co'># Run 20 EM updates to find a good initialization.</span>
<span class='no'>fit0</span> <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>k</span> <span class='kw'>=</span> <span class='fl'>3</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>20</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'>
<span class='co'># The fit_poisson_nmf interface implements 5 different algorithms </span>
<span class='co'># for optimizing a Poisson non-negative matrix factorization. Let's</span>
<span class='co'># run the different algoriths, and compare the quality of the fits.</span>
<span class='no'>fit.mu</span>     <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>400</span>,
                              <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"mu"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.em</span>     <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>400</span>,
                              <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"em"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.ccd</span>    <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,
                              <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"ccd"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.scd</span>    <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,
                              <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"scd"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'>
<span class='no'>clrs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"royalblue"</span>,<span class='st'>"skyblue"</span>,<span class='st'>"darkorange"</span>,<span class='st'>"darkmagenta"</span>)
<span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>mu</span> <span class='kw'>=</span> <span class='no'>fit.mu</span>,<span class='kw'>em</span> <span class='kw'>=</span> <span class='no'>fit.em</span>,<span class='kw'>ccd</span> <span class='kw'>=</span> <span class='no'>fit.ccd</span>,<span class='kw'>scd</span> <span class='kw'>=</span> <span class='no'>fit.scd</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='fu'><a href='compare_poisson_nmf_fits.html'>compare_poisson_nmf_fits</a></span>(<span class='no'>fits</span>),<span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>8</span>)</div><div class='output co'>#&gt;     k     loglik       dev           res runtime nonzeros.f nonzeros.l
#&gt; mu  3 -530270.69 1051628.7 6.5838683e-02   0.632       0.86 0.89583333
#&gt; em  3 -530270.69 1051628.7 6.5838705e-02   0.485       0.86 0.89583333
#&gt; ccd 3 -528244.65 1047576.6 5.3908864e-05   0.392       0.85 0.83750000
#&gt; scd 3 -528244.65 1047576.6 5.4411955e-05   0.356       0.85 0.83750000</div><div class='input'><span class='fu'><a href='plot_progress_poisson_nmf.html'>plot_progress_poisson_nmf</a></span>(<span class='no'>fits</span>,<span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"loglik"</span>,<span class='kw'>colors</span> <span class='kw'>=</span> <span class='no'>clrs</span>)</div><div class='img'><img src='fit_poisson_nmf-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='plot_progress_poisson_nmf.html'>plot_progress_poisson_nmf</a></span>(<span class='no'>fits</span>,<span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"res"</span>,<span class='kw'>colors</span> <span class='kw'>=</span> <span class='no'>clrs</span>)</div><div class='img'><img src='fit_poisson_nmf-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># All algorithms except the multiplicative updates can handle</span>
<span class='co'># sparse matrices as well as dense ones.</span>
<span class='no'>Y</span> <span class='kw'>&lt;-</span> <span class='fu'>as</span>(<span class='no'>X</span>,<span class='st'>"dgCMatrix"</span>)
<span class='no'>fit.em.sp</span>     <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>Y</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>400</span>,
                                 <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"em"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.ccd.sp</span>    <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>Y</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,
                                 <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"ccd"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.scd.sp</span>    <span class='kw'>&lt;-</span> <span class='fu'>fit_poisson_nmf</span>(<span class='no'>Y</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,
                                 <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"scd"</span>,<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>em</span> <span class='kw'>=</span> <span class='no'>fit.em</span>,<span class='kw'>ccd</span> <span class='kw'>=</span> <span class='no'>fit.ccd</span>,<span class='kw'>scd</span> <span class='kw'>=</span> <span class='no'>fit.scd</span>,<span class='kw'>em.sp</span> <span class='kw'>=</span> <span class='no'>fit.em.sp</span>,
             <span class='kw'>ccd.sp</span> <span class='kw'>=</span> <span class='no'>fit.ccd.sp</span>,<span class='kw'>scd.sp</span> <span class='kw'>=</span> <span class='no'>fit.scd.sp</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='fu'><a href='compare_poisson_nmf_fits.html'>compare_poisson_nmf_fits</a></span>(<span class='no'>fits</span>),<span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>8</span>)</div><div class='output co'>#&gt;        k     loglik       dev           res runtime nonzeros.f nonzeros.l
#&gt; em     3 -530270.69 1051628.7 6.5838705e-02   0.485       0.86 0.89583333
#&gt; ccd    3 -528244.65 1047576.6 5.3908864e-05   0.392       0.85 0.83750000
#&gt; scd    3 -528244.65 1047576.6 5.4411955e-05   0.356       0.85 0.83750000
#&gt; em.sp  3 -530270.69 1051628.7 6.5838705e-02   0.344       0.86 0.89583333
#&gt; ccd.sp 3 -528244.65 1047576.6 5.3908864e-05   0.297       0.85 0.83750000
#&gt; scd.sp 3 -528244.65 1047576.6 5.4411955e-05   0.485       0.85 0.83750000</div><div class='input'><span class='fu'><a href='plot_progress_poisson_nmf.html'>plot_progress_poisson_nmf</a></span>(<span class='no'>fits</span>,<span class='kw'>colors</span> <span class='kw'>=</span> <span class='no'>clrs</span>[-<span class='fl'>1</span>],
                          <span class='kw'>shapes</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>19</span>,<span class='fl'>21</span>),<span class='kw'>each</span> <span class='kw'>=</span> <span class='fl'>3</span>))</div><div class='img'><img src='fit_poisson_nmf-3.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># The "extrapolated" updates can sometimes produce much better fits.</span>
<span class='no'>fit.ccd.ex</span> <span class='kw'>&lt;-</span>
  <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,<span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"ccd"</span>,
                  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>extrapolate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fit.scd.ex</span> <span class='kw'>&lt;-</span>
  <span class='fu'>fit_poisson_nmf</span>(<span class='no'>X</span>,<span class='kw'>fit0</span> <span class='kw'>=</span> <span class='no'>fit0</span>,<span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>300</span>,<span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"scd"</span>,
                  <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>extrapolate</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>),<span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; <span class='message'>Using 4 RcppParallel threads.</span></div><div class='input'><span class='no'>fits</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>ccd</span> <span class='kw'>=</span> <span class='no'>fit.ccd</span>,<span class='kw'>scd</span> <span class='kw'>=</span> <span class='no'>fit.scd</span>,<span class='kw'>ccd.ex</span> <span class='kw'>=</span> <span class='no'>fit.ccd.ex</span>,
             <span class='kw'>scd.ex</span> <span class='kw'>=</span> <span class='no'>fit.scd.ex</span>)
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='fu'><a href='compare_poisson_nmf_fits.html'>compare_poisson_nmf_fits</a></span>(<span class='no'>fits</span>),<span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>8</span>)</div><div class='output co'>#&gt;        k     loglik       dev           res runtime nonzeros.f nonzeros.l
#&gt; ccd    3 -528244.65 1047576.6 5.3908864e-05   0.392 0.85000000 0.83750000
#&gt; scd    3 -528244.65 1047576.6 5.4411955e-05   0.356 0.85000000 0.83750000
#&gt; ccd.ex 3 -527639.09 1046365.5 4.5935281e-07   0.882 0.87666667 0.81666667
#&gt; scd.ex 3 -527639.09 1046365.5 1.0219130e-06   0.374 0.87666667 0.81666667</div><div class='input'><span class='fu'><a href='plot_progress_poisson_nmf.html'>plot_progress_poisson_nmf</a></span>(<span class='no'>fits</span>,<span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"loglik"</span>,<span class='kw'>colors</span> <span class='kw'>=</span> <span class='no'>clrs</span>[<span class='fl'>3</span>:<span class='fl'>4</span>],
                          <span class='kw'>shapes</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>19</span>,<span class='fl'>21</span>),<span class='kw'>each</span> <span class='kw'>=</span> <span class='fl'>2</span>))</div><div class='img'><img src='fit_poisson_nmf-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='plot_progress_poisson_nmf.html'>plot_progress_poisson_nmf</a></span>(<span class='no'>fits</span>,<span class='kw'>y</span> <span class='kw'>=</span> <span class='st'>"res"</span>,<span class='kw'>colors</span> <span class='kw'>=</span> <span class='no'>clrs</span>[<span class='fl'>3</span>:<span class='fl'>4</span>],
                          <span class='kw'>shapes</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>19</span>,<span class='fl'>21</span>),<span class='kw'>each</span> <span class='kw'>=</span> <span class='fl'>2</span>))</div><div class='img'><img src='fit_poisson_nmf-5.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Peter Carbonetto, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


