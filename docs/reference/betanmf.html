<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Multiplicative Update Rules for Non-negative Matrix Factorization — betanmf • fastTopics</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Multiplicative Update Rules for Non-negative Matrix Factorization — betanmf" />

<meta property="og:description" content="This function decomposes the input matrix X = L*F' by
  nonnegative matrix factorization (NMF) based on the &quot;divergence&quot;
  criterion; equivalently, it optimizes the likelihood under a
  Poisson model of the count data, X. It runs a specified number of
  multiplicative updates (MU) to fit the L and F matrices. Note that
  the multiplicative updates can also be derived, and hence
  interpreted, as an expectation maximization (EM) algorithm." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastTopics</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.22</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/stephenslab/fastTopics">Source</a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Multiplicative Update Rules for Non-negative Matrix Factorization</h1>
    <small class="dont-index">Source: <a href='https://github.com/stephenslab/fastTopics/blob/master/R/betanmf.R'><code>R/betanmf.R</code></a></small>
    <div class="hidden name"><code>betanmf.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function decomposes the input matrix X = L*F' by
  nonnegative matrix factorization (NMF) based on the "divergence"
  criterion; equivalently, it optimizes the likelihood under a
  Poisson model of the count data, X. It runs a specified number of
  multiplicative updates (MU) to fit the L and F matrices. Note that
  the multiplicative updates can also be derived, and hence
  interpreted, as an expectation maximization (EM) algorithm.</p>
    
    </div>

    <pre class="usage"><span class='fu'>betanmf</span>(<span class='no'>X</span>, <span class='no'>F0</span>, <span class='no'>L0</span>, <span class='kw'>numiter</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>lowerbound</span> <span class='kw'>=</span> <span class='fl'>1e-15</span>, <span class='kw'>e</span> <span class='kw'>=</span> <span class='fl'>1e-15</span>,
  <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>X</th>
      <td><p>The n x m matrix of counts; all entries of X should be
non-negative. In particular, sparse matrices are not accommodated
in this implementation; <code>is.matrix(X)</code> must give <code>TRUE</code>,
otherwise an error will be thrown.</p></td>
    </tr>
    <tr>
      <th>F0</th>
      <td><p>This is the initial estimate of the factors (also called
"basis vectors"). It should be an m x k matrix, where m is the
 number of columns of X, and k &gt; 1 is the rank of the matrix
 factorization, or the number of topics. All entries of F should be
 non-negative.</p></td>
    </tr>
    <tr>
      <th>L0</th>
      <td><p>This is the initial estimate of the loadings (also called
"activations"). It should an n x k matrix, where n is the number of
rows of X, and k &gt; 1 is the rank of the matrix factorization. All
entries of L should be non-negative.</p></td>
    </tr>
    <tr>
      <th>numiter</th>
      <td><p>The number of multiplicative updates to run.</p></td>
    </tr>
    <tr>
      <th>lowerbound</th>
      <td><p>A small positive constant used to safeguard the
multiplicative updates. The multiplicative updates are implemented
as <code>F &lt;- pmax(F1,lowerbound)</code> and <code>L &lt;- pmax(L1,lowerbound)</code>,
where <code>F1</code> and <code>L1</code> are the factors and loadings
matrices obtained by applying a single multiplicative update
rule. Setting <code>lowerbound = 0</code> is allowed, but the
multiplicative updates are not guaranteed to converge to a
stationary point without this safeguard, and a warning will be
given in this case.</p></td>
    </tr>
    <tr>
      <th>e</th>
      <td><p>A small, non-negative number added to the terms inside the
logarithms to avoid computing logarithms of zero. This prevents
numerical problems at the cost of introducing a very small
inaccuracy in the computation.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>When <code>verbose = TRUE</code>, information about the
algorithm's progress is printed to the console at every iteration.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list containing updated estimates of the factors, F, and
  loadings, L.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The multiplicative updates are very simple and
  fast. However, they can also be very slow to converge to a
  stationary point of the objective, particularly when the data are
  sparse.</p>
<p>This function is mainly for internal use, and should only
  be called directly if you really know what you are doing. In
  particular, only minimal argument checking is performed; if you are
  not careful, you will get poor results are errors that are
  difficult to interpret.</p>
<p>This implementation is adapted from the MATLAB code by Daichi
  Kitamura <a href='http://d-kitamura.net'>http://d-kitamura.net</a>.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Gillis, N. and Glineur, F. (2012). Accelerated multiplicative
  updates and hierarchical ALS algorithms for nonnegative matrix
  factorization. <em>Neural Computation</em> <code>24</code>, 1085–1105.</p>
<p>Lee, D. D. and Seung, H. S. (2001). Algorithms for
  non-negative matrix factorization. In <em>Advances in Neural
  Information Processing Systems</em> <b>13</b>, 556–562.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>fit_topics</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'># Simulate a 100 x 200 data set.</span>
<span class='fu'>set.seed</span>(<span class='fl'>1</span>)
<span class='no'>X</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='simulate_count_data.html'>simulate_count_data</a></span>(<span class='fl'>100</span>,<span class='fl'>200</span>,<span class='fl'>3</span>)$<span class='no'>X</span>

<span class='co'># Fit a Poisson topic model with k = 3 topics by running 100</span>
<span class='co'># multiplicative updates.</span>
<span class='no'>F0</span>  <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>runif</span>(<span class='fl'>600</span>),<span class='fl'>200</span>,<span class='fl'>3</span>)
<span class='no'>L0</span>  <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='fu'>runif</span>(<span class='fl'>300</span>),<span class='fl'>100</span>,<span class='fl'>3</span>)
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>betanmf</span>(<span class='no'>X</span>,<span class='no'>F0</span>,<span class='no'>L0</span>,<span class='fl'>100</span>)</div><div class='output co'>#&gt; iter      log-likelihood            deviance max|F-F'| max|L-L'|
#&gt;    1 -2.186277435680e+04 +2.119256710296e+04 9.738e-01 1.112e+00
#&gt;    2 -2.175853467178e+04 +2.098408773293e+04 1.292e-01 1.294e-01
#&gt;    3 -2.169295978749e+04 +2.085293796435e+04 1.060e-01 9.873e-02
#&gt;    4 -2.164683672271e+04 +2.076069183480e+04 8.928e-02 7.862e-02
#&gt;    5 -2.161129719704e+04 +2.068961278345e+04 7.663e-02 6.148e-02
#&gt;    6 -2.158186759554e+04 +2.063075358046e+04 6.658e-02 4.839e-02
#&gt;    7 -2.155616349822e+04 +2.057934538582e+04 5.825e-02 4.585e-02
#&gt;    8 -2.153287177720e+04 +2.053276194378e+04 5.111e-02 4.339e-02
#&gt;    9 -2.151126351152e+04 +2.048954541242e+04 4.486e-02 4.077e-02
#&gt;   10 -2.149094123489e+04 +2.044890085915e+04 4.308e-02 3.799e-02
#&gt;   11 -2.147169659189e+04 +2.041041157316e+04 4.405e-02 3.510e-02
#&gt;   12 -2.145342697222e+04 +2.037387233382e+04 4.412e-02 3.219e-02
#&gt;   13 -2.143608753699e+04 +2.033919346336e+04 4.328e-02 2.935e-02
#&gt;   14 -2.141966360275e+04 +2.030634559488e+04 4.460e-02 2.828e-02
#&gt;   15 -2.140415354180e+04 +2.027532547297e+04 4.574e-02 2.735e-02
#&gt;   16 -2.138955726589e+04 +2.024613292115e+04 4.588e-02 2.660e-02
#&gt;   17 -2.137586846167e+04 +2.021875531271e+04 4.504e-02 2.581e-02
#&gt;   18 -2.136307001520e+04 +2.019315841978e+04 4.335e-02 2.560e-02
#&gt;   19 -2.135113230250e+04 +2.016928299438e+04 4.098e-02 2.569e-02
#&gt;   20 -2.134001386308e+04 +2.014704611554e+04 3.816e-02 2.559e-02
#&gt;   21 -2.132966377344e+04 +2.012634593626e+04 3.693e-02 2.535e-02
#&gt;   22 -2.132002495424e+04 +2.010706829786e+04 3.579e-02 2.500e-02
#&gt;   23 -2.131103770608e+04 +2.008909380153e+04 3.457e-02 2.460e-02
#&gt;   24 -2.130264293195e+04 +2.007230425327e+04 3.299e-02 2.413e-02
#&gt;   25 -2.129478470516e+04 +2.005658779969e+04 3.113e-02 2.361e-02
#&gt;   26 -2.128741202619e+04 +2.004184244175e+04 2.910e-02 2.302e-02
#&gt;   27 -2.128047975827e+04 +2.002797790591e+04 2.700e-02 2.236e-02
#&gt;   28 -2.127394883565e+04 +2.001491606067e+04 2.490e-02 2.162e-02
#&gt;   29 -2.126778590604e+04 +2.000259020144e+04 2.284e-02 2.079e-02
#&gt;   30 -2.126196260104e+04 +1.999094359145e+04 2.185e-02 1.989e-02
#&gt;   31 -2.125645463058e+04 +1.997992765054e+04 2.241e-02 1.893e-02
#&gt;   32 -2.125124087330e+04 +1.996950013597e+04 2.315e-02 1.793e-02
#&gt;   33 -2.124630259048e+04 +1.995962357032e+04 2.366e-02 1.691e-02
#&gt;   34 -2.124162283350e+04 +1.995026405638e+04 2.396e-02 1.589e-02
#&gt;   35 -2.123718605526e+04 +1.994139049989e+04 2.407e-02 1.487e-02
#&gt;   36 -2.123297788777e+04 +1.993297416491e+04 2.401e-02 1.414e-02
#&gt;   37 -2.122898502179e+04 +1.992498843296e+04 2.381e-02 1.398e-02
#&gt;   38 -2.122519512156e+04 +1.991740863250e+04 2.350e-02 1.379e-02
#&gt;   39 -2.122159672682e+04 +1.991021184301e+04 2.310e-02 1.359e-02
#&gt;   40 -2.121817912515e+04 +1.990337663967e+04 2.263e-02 1.337e-02
#&gt;   41 -2.121493220816e+04 +1.989688280569e+04 2.244e-02 1.313e-02
#&gt;   42 -2.121184634290e+04 +1.989071107518e+04 2.293e-02 1.287e-02
#&gt;   43 -2.120891228971e+04 +1.988484296880e+04 2.308e-02 1.260e-02
#&gt;   44 -2.120612118130e+04 +1.987926075197e+04 2.291e-02 1.231e-02
#&gt;   45 -2.120346455656e+04 +1.987394750249e+04 2.246e-02 1.201e-02
#&gt;   46 -2.120093442563e+04 +1.986888724063e+04 2.176e-02 1.170e-02
#&gt;   47 -2.119852333746e+04 +1.986406506430e+04 2.088e-02 1.138e-02
#&gt;   48 -2.119622442712e+04 +1.985946724362e+04 1.987e-02 1.105e-02
#&gt;   49 -2.119403143222e+04 +1.985508125381e+04 1.876e-02 1.071e-02
#&gt;   50 -2.119193868046e+04 +1.985089575028e+04 1.761e-02 1.037e-02
#&gt;   51 -2.118994105704e+04 +1.984690050345e+04 1.645e-02 1.002e-02
#&gt;   52 -2.118803396079e+04 +1.984308631096e+04 1.548e-02 9.672e-03
#&gt;   53 -2.118621325333e+04 +1.983944489603e+04 1.491e-02 9.323e-03
#&gt;   54 -2.118447520054e+04 +1.983596879046e+04 1.435e-02 9.066e-03
#&gt;   55 -2.118281640412e+04 +1.983265119761e+04 1.380e-02 8.818e-03
#&gt;   56 -2.118123372329e+04 +1.982948583596e+04 1.327e-02 8.569e-03
#&gt;   57 -2.117972419204e+04 +1.982646677345e+04 1.275e-02 8.320e-03
#&gt;   58 -2.117828494073e+04 +1.982358827082e+04 1.246e-02 8.072e-03
#&gt;   59 -2.117691313189e+04 +1.982084465314e+04 1.218e-02 7.826e-03
#&gt;   60 -2.117560591689e+04 +1.981823022314e+04 1.187e-02 7.582e-03
#&gt;   61 -2.117436041531e+04 +1.981573921999e+04 1.153e-02 7.466e-03
#&gt;   62 -2.117317371437e+04 +1.981336581812e+04 1.118e-02 7.379e-03
#&gt;   63 -2.117204288287e+04 +1.981110415512e+04 1.081e-02 7.297e-03
#&gt;   64 -2.117096499340e+04 +1.980894837618e+04 1.042e-02 7.221e-03
#&gt;   65 -2.116993714747e+04 +1.980689268432e+04 1.003e-02 7.149e-03
#&gt;   66 -2.116895649973e+04 +1.980493138883e+04 9.630e-03 7.080e-03
#&gt;   67 -2.116802027898e+04 +1.980305894734e+04 9.228e-03 7.013e-03
#&gt;   68 -2.116712580518e+04 +1.980126999973e+04 8.826e-03 6.949e-03
#&gt;   69 -2.116627050205e+04 +1.979955939347e+04 8.607e-03 6.885e-03
#&gt;   70 -2.116545190596e+04 +1.979792220130e+04 8.433e-03 6.823e-03
#&gt;   71 -2.116466767141e+04 +1.979635373219e+04 8.239e-03 6.760e-03
#&gt;   72 -2.116391557384e+04 +1.979484953706e+04 8.028e-03 6.698e-03
#&gt;   73 -2.116319351044e+04 +1.979340541025e+04 7.805e-03 6.636e-03
#&gt;   74 -2.116249949926e+04 +1.979201738789e+04 7.573e-03 6.573e-03
#&gt;   75 -2.116183167729e+04 +1.979068174395e+04 7.335e-03 6.511e-03
#&gt;   76 -2.116118829757e+04 +1.978939498451e+04 7.096e-03 6.448e-03
#&gt;   77 -2.116056772575e+04 +1.978815384087e+04 7.089e-03 6.384e-03
#&gt;   78 -2.115996843617e+04 +1.978695526171e+04 7.150e-03 6.321e-03
#&gt;   79 -2.115938900762e+04 +1.978579640462e+04 7.186e-03 6.258e-03
#&gt;   80 -2.115882811893e+04 +1.978467462723e+04 7.198e-03 6.195e-03
#&gt;   81 -2.115828454442e+04 +1.978358747822e+04 7.188e-03 6.132e-03
#&gt;   82 -2.115775714949e+04 +1.978253268836e+04 7.155e-03 6.069e-03
#&gt;   83 -2.115724488621e+04 +1.978150816179e+04 7.103e-03 6.007e-03
#&gt;   84 -2.115674678924e+04 +1.978051196785e+04 7.031e-03 5.945e-03
#&gt;   85 -2.115626197196e+04 +1.977954233329e+04 6.943e-03 5.883e-03
#&gt;   86 -2.115578962285e+04 +1.977859763507e+04 6.840e-03 5.821e-03
#&gt;   87 -2.115532900202e+04 +1.977767639340e+04 6.723e-03 5.760e-03
#&gt;   88 -2.115487943772e+04 +1.977677726482e+04 6.704e-03 5.700e-03
#&gt;   89 -2.115444032273e+04 +1.977589903483e+04 6.768e-03 5.639e-03
#&gt;   90 -2.115401111021e+04 +1.977504060980e+04 6.809e-03 5.580e-03
#&gt;   91 -2.115359130918e+04 +1.977420100773e+04 6.828e-03 5.520e-03
#&gt;   92 -2.115318047918e+04 +1.977337934774e+04 6.826e-03 5.462e-03
#&gt;   93 -2.115277822452e+04 +1.977257483842e+04 6.803e-03 5.403e-03
#&gt;   94 -2.115238418800e+04 +1.977178676538e+04 6.760e-03 5.346e-03
#&gt;   95 -2.115199804457e+04 +1.977101447852e+04 6.700e-03 5.290e-03
#&gt;   96 -2.115161949525e+04 +1.977025737986e+04 6.624e-03 5.288e-03
#&gt;   97 -2.115124826161e+04 +1.976951491259e+04 6.534e-03 5.280e-03
#&gt;   98 -2.115088408128e+04 +1.976878655193e+04 6.431e-03 5.264e-03
#&gt;   99 -2.115052670452e+04 +1.976807179841e+04 6.318e-03 5.240e-03
#&gt;  100 -2.115017589207e+04 +1.976737017352e+04 6.196e-03 5.208e-03</div><div class='input'>
<span class='co'># Plot the improvement in the solution over time.</span>
<span class='no'>dev.min</span> <span class='kw'>&lt;-</span> <span class='fl'>19661.4155</span>
<span class='fu'>with</span>(<span class='no'>fit</span>$<span class='no'>progress</span>,
     <span class='fu'>plot</span>(<span class='no'>iter</span>,<span class='no'>dev</span> - <span class='no'>dev.min</span>,<span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"l"</span>,<span class='kw'>log</span> <span class='kw'>=</span> <span class='st'>"y"</span>,
          <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"iteration"</span>,<span class='kw'>ylab</span> <span class='kw'>=</span> <span class='st'>"distance to solution"</span>))</div><div class='img'><img src='betanmf-1.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Peter Carbonetto, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

